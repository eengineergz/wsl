"use strict";var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var vscode_1=require("vscode"),Main_1=require("../core/Main"),BaseCommands_1=require("../core/BaseCommands"),document_1=require("../core/document"),Utils_1=require("../core/Utils"),Hub=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.items=new Map,t.showWhenEmpty=!1,t}return __extends(t,e),t.prototype.initialize=function(){var e=this;this.document=new document_1.default(this),this.document.addListener(this),vscode_1.commands.getCommands().then(function(t){-1===t.indexOf("provision.help")&&(e.registerCommand("provision.help",function(){return BaseCommands_1.default.Help()},!1),e.registerCommand("provision.list",function(){return BaseCommands_1.default.List(e,e.data)},!1))})},t.prototype.configChanged=function(){var o=this;this.items&&this.items.forEach(function(t,e){o.removeItem(e)}),this.showWhenEmpty=this.config.get("showWhenEmpty",!1);var t=this.config.get("keywords",{});Object.keys(t).forEach(function(t){var e=Utils_1.default.getGroup(o,t);o.registerCommand("provision.popup."+e,function(){return BaseCommands_1.default.Popup(o,o.data[e])},!0)})},t.prototype.dispose=function(){this.items&&this.items.forEach(function(t){return t.dispose()})},t.prototype.update=function(t){if(this.data=t)for(var e in t)0!==t[e].items.length||this.showWhenEmpty?this.createItem(e,t[e]):this.removeItem(e);else this.dispose()},t.prototype.detailedUpdate=function(t){},t.prototype.removeItem=function(t){var e=this.items.get(t);e&&(e.dispose(),this.items.delete(t))},t.prototype.createItem=function(t,e){var o;if(this.items.has(t))o=this.items.get(t);else{var i=this.config.get("bar.position","left");o=vscode_1.window.createStatusBarItem("left"===i?vscode_1.StatusBarAlignment.Left:vscode_1.StatusBarAlignment.Right,this.config.get("bar.priority",1))}if(o){var n=Utils_1.default.getGroupProps(this,t);n.tooltip&&n.tooltip.length&&(o.tooltip=n.tooltip);var s=Utils_1.default.getTitle(t,n.title,e.amount);o.text=s,o.command=this.getUUID()+"provision.popup."+t,this.items.set(t,o),o.show()}},t}(Main_1.default);exports.default=Hub;